title: Shell 循环中实现展示进度百分比的脚本方法
date: 2018-06-29 00:00:00 +0800
update: 2018-06-29 00:00:00 +0800
author: fungleo
tags:
    -shell
    -脚本
    -进度条
    -进度百分比
    -bash
---

# Shell 循环中实现展示进度百分比的脚本方法

当我需要处理一个几万行的文件的时候，需要处理的时间是比较长的。我一开始的想法是，没处理一行，就输出一个 `#` 号。但是这样还是会出现很多很多的 `#` 号，即便是放在一行，也是非常不优雅的。所以，我想实现一个展示进度百分比的脚本。

## 实现思路

1. 获取文件的行数
2. 用 `i++` 实现每行处理的计数
3. 当前处理行数*100再除以文件行数+`%`得到我要输出的百分比结果
4. 我需要在一行展示，而不是一直追加或者每次都显示一行

就是这些需求了。我们来逐渐实现。

## 获取文件的行数

这个比较简单，用 `wc -l $file` 就能获取到了。但是得到的结果我不是很满意:

```
     999 3.log
```
在结果的前面有几个空格，我得把空格去掉，于是代码就改成了

```
wc -l $file | sed 's/^[ \t]*//g'
```

这样就去掉了开头的空格，然后用空格分割，取第一个就可以了，`cut`来实现

```
wc -l $file | sed 's/^[ \t]*//g' | cut -d ' ' -f1
```

OK，通过几个命令的组合，很容易的实现了获取行数的数字。

## echo 实现单行显示

```
echo -en '\b\b\b\b'
```

如上，就是将光标提前四个位置，并录入内容。`\b`是提前一个，输入几个就几个，如果已经到了开头了，就不能往前挪了，所以，多输入几个是没问题的。

## 最终实现代码如下：

```
# 定义变量 i
i=1

# 获取 3.log 这个文件的行数，并把运行结果赋予变量 l
l=$(wc -l 3.log | sed 's/^[ \t]*//g' | cut -d ' ' -f1)

# 每行遍历循环
while read line; do
  
  # 输出百分比
  echo -en "\b\b\b\b"`echo $i*100/$l | bc `'%'
  
  # 计算 i++
  ((i++))

# 传入 3.log 这个要处理的文件
done < 3.log
# 完成时打个OK，因为字符长度不足以遮盖原先的百分比，所以后面加了几个空格
echo -e '\b\b\b\bOK     '
```

实现效果如下

![](https://raw.githubusercontent.com/fengcms/articles/master/image/42/87a0692fb93a03f300e023c7875a99.gif)
好，通过简单的几行代码，就实现了我想要的效果了。

以上脚本均在 mac 下测试通过，在 linux 下可能会有稍许不同。

本文由 FungLeo 原创，允许转载，但转载必须保留首发链接。


